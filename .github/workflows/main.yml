name: –ï–∂–µ–¥–Ω–µ–≤–Ω—ã–µ —Å–ª—É—á–∞–π–Ω—ã–µ –∫–æ–º–º–∏—Ç—ã (1-3 —à—Ç)

on:
  schedule:
    - cron: '0 0 * * *'   # –ö–∞–∂–¥—ã–π –¥–µ–Ω—å –≤ 00:00 UTC
  workflow_dispatch:      # –ú–æ–∂–Ω–æ –∑–∞–ø—É—Å—Ç–∏—Ç—å –≤—Ä—É—á–Ω—É—é –¥–ª—è —Ç–µ—Å—Ç–∞

jobs:
  random-commits:
    runs-on: ubuntu-latest
    steps:
      - name: –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.11'

      - name: Checkout
        uses: actions/checkout@v4

      - name: –ù–∞—Å—Ç—Ä–æ–∏—Ç—å Git –ø–æ–¥ —Ç–≤–æ–π –∞–∫–∫–∞—É–Ω—Ç
        run: |
          git config --local user.email "zmosY@users.noreply.github.com"
          git config --local user.name "zmosY"

      - name: –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å —Å–ª—É—á–∞–π–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–æ–º–º–∏—Ç–æ–≤ (1-3) –∏ —Å–¥–µ–ª–∞—Ç—å –∏—Ö
        run: |
          # –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º —Å–ª—É—á–∞–π–Ω–æ–µ —á–∏—Å–ª–æ –æ—Ç 1 –¥–æ 3
          COMMITS_COUNT=$(( (RANDOM % 3) + 1 ))
          echo "üé≤ –ë—É–¥–µ—Ç —Å–¥–µ–ª–∞–Ω–æ $COMMITS_COUNT –∫–æ–º–º–∏—Ç–æ–≤ —Å–µ–≥–æ–¥–Ω—è"

          for i in $(seq 1 $COMMITS_COUNT); do
            echo "‚û°Ô∏è –ì–æ—Ç–æ–≤–∏–º –∫–æ–º–º–∏—Ç ‚Ññ$i..."

            # –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º —É–Ω–∏–∫–∞–ª—å–Ω–æ–µ –∏–º—è —Ñ–∞–π–ª–∞
            FILENAME="commit-file-$(date +%Y%m%d)-$i-$(shuf -i 1000-9999 -n 1).txt"

            # –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º —Å–ª—É—á–∞–π–Ω—ã–µ —Å–∏–º–≤–æ–ª—ã —Å –ø–æ–º–æ—â—å—é Python (heredoc)
            python3 << END_PYTHON
import random
import string

chars = ''.join(random.choices(string.ascii_letters + string.digits, k=50))
with open('$FILENAME', 'w') as f:
    f.write(chars + '\\n')

print(f'‚úÖ –§–∞–π–ª {FILENAME} —Å–æ–∑–¥–∞–Ω.')
END_PYTHON

            # –î–æ–±–∞–≤–ª—è–µ–º, –∫–æ–º–º–∏—Ç–∏–º –∏ –ø—É—à–∏–º
            git add "$FILENAME"
            git commit -m "üìù –ö–æ–º–º–∏—Ç ‚Ññ$i –∏–∑ $COMMITS_COUNT: $(date +%Y-%m-%d)"
            git push

            echo "‚úÖ –ö–æ–º–º–∏—Ç ‚Ññ$i –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω!"
            echo "-------------------"
          done

          echo "üéâ –í—Å–µ–≥–æ —Å–¥–µ–ª–∞–Ω–æ $COMMITS_COUNT –∫–æ–º–º–∏—Ç–æ–≤ –∑–∞ —Å–µ–≥–æ–¥–Ω—è."
